---
title: "1. Биномиальные данные"
author: "Г. Мороз"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

<style>
.parallax {
    /* The image used */
    background-image: url("1_coin.jpg");

    /* Set a specific height */
    min-height: 350px; 

    /* Create the parallax scrolling effect */
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: auto;
}
</style>

<div class="parallax"></div>


### 1. Введение

* ваши данные имеют два возможных исхода
    * head vs.  tail
    * орел vs. решка
    * 1 vs. 0
    * выпадение 6 на кубике
    * количество диалектных vs. недиалектных форм у одного информанта
    * употребление слова _кенгуру_ в некотором тексте
    * ...
    
* у вас есть идеи по поводу возможного распределения

Библиотеки:
```{r}
library(tidyverse)
library(mosaic)
```

<div class="parallax"></div>

### 2. Биномиальное  распределение

$P(k | n, p) = \frac{n!}{k!(n-k)!} \times p^k \times (1-p)^{n-k} =  {n \choose k} \times p^k \times (1-p)^{n-k}; 0 \leq p \leq 1; n, k > 0 $

```{r}
probabilities <- c(0.23, 0.33, 0.69)
density <- c(dbinom(x = 1:83, size = 83, prob = probabilities[1]),
             dbinom(x = 1:83, size = 83, prob = probabilities[2]),
             dbinom(x = 1:83, size = 83, prob = probabilities[3]))
params <- rep(paste("n = 83, p =", probabilities), each = 83)
id <- rep(1:83, 3)
binomials <- data_frame(density, params, id)

binomials %>% 
  ggplot(aes(id, density, fill = params))+
  geom_polygon(alpha = 0.8)+
  labs(title = "PDF для трех биномиальных распределений")+
  theme_bw()
```

$E[X] = np; D[X] = np\times(n-1)$

<div class="parallax"></div>

### 3. Биномиальный тест

* Нулевая гипотеза: вероятность количества успехов статистически не отличается от ожидаемой вероятности.

```{r}
binomial_test <- binom.test(x = 27, n = 83, p = 0.23)
binomial_test
```

```{r}
binomials %>% 
  filter(params == "n = 83, p = 0.23") %>% 
  ggplot(aes(id, density))+
  geom_line()+
  geom_area(aes(x = ifelse(id>=qbinom(0.025, 83, 0.23) &
                           id<=qbinom(0.975, 83, 0.23), id, NA)),
            fill = "lightblue")+
  geom_vline(xintercept = 27, linetype = 2)+
  scale_x_continuous(breaks = c(0, 12, 19, 27, 2:4*20))+
  theme_bw()+
  labs(title = "Биномиальное распределение с параметрами n = 83, p = 0.23",
       subtitle = "Голубой — центральные 95% данных")
```


<div class="parallax"></div>

### 4. Хакерский подход: симуляция
```{r}
set.seed(42)
do(1000)*
  sum(sample(x = 1:0, 
             size = 83, 
             prob = c(0.23, 0.77), 
             replace = TRUE)) ->
  simulations
simulations %>% 
  mutate(greater = sum >= 27) %>% 
  group_by(greater) %>% 
  summarise(number = n())
simulations %>% 
  ggplot(aes(sum))+
  geom_density(fill = "lightblue")+
  geom_vline(xintercept = 27, linetype = 2)+
  theme_bw()+
  labs(title = "Распределение 1000 симуляций с параметрами n = 83, p = 0.23")
```

<div class="parallax"></div>


### 5. Бета распределение

$f(x; α, β) = \frac{1}{B(α, β)}\times x^{α-1}\times (1-x)^{β-1}; 0 \leq x \leq 1; α, β > 0$
Бета функция:
$Β(α, β) = \frac{Γ(α)\times Γ(β)}{Γ(α+β)} = \frac{(α-1)!(β-1)!}{(α+β-1)!} $

```{r}
x <- seq(0, 1, length = 100)
alpha <- c(23, 33, 69)
beta <- 83-alpha
density <- c(dbeta(x, shape1 = alpha[1], shape2 = beta[1]),
             dbeta(x, shape1 = alpha[2], shape2 = beta[2]),
             dbeta(x, shape1 = alpha[3], shape2 = beta[3]))
params <- rep(paste("α =", alpha, ", β =", beta), each = 100)
betas <- data_frame(density, params, id = rep(x, 3))

betas %>% 
  ggplot(aes(id, density, fill = params))+
  geom_polygon(alpha = 0.8)+
  labs(title = "PDF для трех бета распределений")+
  theme_bw()
```

$$Ε[X] = \frac{α}{α+β}; D[X] = \frac{α\times β}{(α+β)^2(α+β+1)}$$


<div class="parallax"></div>

### 6. Байесовский подход

$P(θ|y) = \frac{P(θ)P(y|θ)}{P(y)}$
$P(θ|y) \propto P(θ)P(y|θ)$



<div class="parallax"></div>
